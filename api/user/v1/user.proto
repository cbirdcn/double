syntax = "proto3";

package api.user.v1;

import "google/api/annotations.proto";

// 建议包名简称为"service_版本号"，不支持点号连接
option go_package = "double/api/user/v1;user_v1";

service User {
  // 增删改查列
  rpc CreateUser (CreateUserRequest) returns (CreateUserReply){
    option (google.api.http) = {
      post : "v1/user"
      body : "*"
    };
  };
  rpc BanUser (BanUserRequest) returns (BanUserReply) {
    option (google.api.http) = {
      put : "v1/user_ban/{id}"
      body : "*"
    };
  };
  rpc UpdateUserName (UpdateUserNameRequest) returns (UpdateUserNameReply) {
    option (google.api.http) = {
      put : "v1/user_update_name/{id}"
      body : "*"
    };
  };
  rpc UpdateUserPassword (UpdateUserPasswordRequest) returns (UpdateUserPasswordReply) {
    option (google.api.http) = {
      put : "v1/user_update_password/{id}"
      body : "*"
    };
  };
  rpc GetUser (GetUserRequest) returns (GetUserReply) {
    option (google.api.http) = {
      get : "v1/user/{id}"
    };
  };
  // todo:暂不支持，需要先完成id list
  rpc ListUser (ListUserRequest) returns (ListUserReply) {
    option (google.api.http) = {
      get : "v1/user"
    };
  };
  // 登录
  rpc UserLogin (UserLoginRequest) returns (UserLoginReply) {
    option (google.api.http) = {
      post : "v1/login"
      body : "*"
    };
  };
  // 登出（忽略）
  rpc UserLogout (UserLogoutRequest) returns (UserLogoutReply) {
    option (google.api.http) = {
      post : "v1/logout"
      body : "*"
    };
  };
}

message UserDetail {
  int64 id = 1;
  string userName = 2;
  string clubName = 3;
  string createdAt = 4;
}

// 创建角色（角色名、俱乐部名称唯一）
message CreateUserRequest {
  string userName = 1; // todo:validator:not empty
  string password = 2;
  string clubName = 3;
}
message CreateUserReply {
  UserDetail userDetail = 1;
}

// todo：ajax请求，忽略
//// 确认密码符合格式要求
//message VerifyPasswordRequest {
//  string userName = 1;
//  string password = 2;
//}
//
//message VerifyPasswordReply {
//  bool ok = 1;
//}
//
//// 确认角色名是否可用
//message VerifyUserNameRequest {
//  string username = 1;
//}
//
//message VerifyUserNameReply {
//  bool ok = 1;
//}
//
//// 确认俱乐部名是否可用
//message VerifyClubNameRequest {
//  string password = 2;
//}
//
//message VerifyClubNameReply {
//  bool ok = 1;
//}

// 禁用角色，不会物理删除
message BanUserRequest {
  int64 id = 1;
}
message BanUserReply {
  bool res = 1;
}

// 改名
message UpdateUserNameRequest {
  int64 id = 1;
  string newUserName = 2;
}
message UpdateUserNameReply {
  bool res = 1;
}

// 换密码
message UpdateUserPasswordRequest {
  int64 id = 1;
  string oldUserPassword = 2;
  string newUserPassword = 3;
}
message UpdateUserPasswordReply {
  bool res = 1;
}

// 查询单一角色信息
message GetUserRequest {
  int64 id = 1;
}
message GetUserReply {
  UserDetail userDetail = 1;
}

// 批量查询角色信息
message ListUserRequest {
}
message ListUserReply {
  repeated UserDetail userDetails = 1;
}

// 登录
message UserLoginRequest {
  string userName = 1;
  string password = 2;
}

message UserLoginReply {
  bool res = 1;
  UserDetail userDetail = 2;
}

// 登出
message UserLogoutRequest {
  int64 id = 1;
}

message UserLogoutReply {
  bool res = 1;
}
